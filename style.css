document.addEventListener("DOMContentLoaded", () => {

  const addBtn = document.getElementById("addBtn");
  const todoInput = document.getElementById("todoInput");
  const todoList = document.getElementById("todoList");

  let todos = JSON.parse(localStorage.getItem("todos")) || [];
  let currentFilter = "all";

  function renderTodos() {
    todoList.innerHTML = "";

    let filteredTodos = [...todos];

    if (currentFilter === "active") {
      filteredTodos = filteredTodos.filter(todo => !todo.completed);
    } else if (currentFilter === "completed") {
      filteredTodos = filteredTodos.filter(todo => todo.completed);
    }

    filteredTodos.forEach((todo) => {
      const li = document.createElement("li");

      if (todo.completed) {
        li.classList.add("completed");
      }

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = todo.completed;

      checkbox.addEventListener("change", function () {
        todo.completed = checkbox.checked;
        saveTodos();
        renderTodos();
      });

      const span = document.createElement("span");
      span.innerText = todo.text;

      const deleteBtn = document.createElement("button");
      deleteBtn.innerText = "삭제";
      deleteBtn.style.display = todo.completed ? "inline-block" : "none";

      deleteBtn.addEventListener("click", function () {
        if (!confirm("정말 삭제하시겠습니까?")) return;

        const todoIndex = todos.indexOf(todo);
        todos.splice(todoIndex, 1);
        saveTodos();
        renderTodos();
      });

      li.appendChild(checkbox);
      li.appendChild(span);
      li.appendChild(deleteBtn);

      todoList.appendChild(li);
    });
  }

  function saveTodos() {
    localStorage.setItem("todos", JSON.stringify(todos));
  }

  addBtn.addEventListener("click", function () {
    const text = todoInput.value.trim();

    if (text === "") {
      alert("할 일을 입력하세요!");
      return;
    }

    const isDuplicate = todos.some(todo => todo.text === text);
    if (isDuplicate) {
      alert("이미 추가된 할 일입니다.");
      return;
    }

    todos.push({
      text: text,
      completed: false,
    });

    saveTodos();
    renderTodos();
    todoInput.value = "";
  });

  todoInput.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      addBtn.click();
    }
  });

  document.querySelectorAll(".filter button").forEach(button => {
    button.addEventListener("click", function () {
      const selectedFilter = button.dataset.filter;

      if (currentFilter === selectedFilter) {
        currentFilter = "all";
      } else {
        currentFilter = selectedFilter;
      }

      document.querySelectorAll(".filter button").forEach(btn =>
        btn.classList.remove("active")
      );

      if (currentFilter !== "all") {
        button.classList.add("active");
      }

      renderTodos();
    });
  });

  renderTodos();
});
